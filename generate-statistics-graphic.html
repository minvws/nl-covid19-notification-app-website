<!DOCTYPE html>
<html lang="en">
<head>
    <link href="/css/main.css" rel="stylesheet">

    <style>textarea { width: 100%; height: 100%; } hr { margin: 20px 0 } input { text-align: right; font-family: 'courier' }</style>

    <link rel="preload" as="font" href="/fonts/ROsanswebtextregular.woff2" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" as="font" href="/fonts/ROsanswebtextregular.woff" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" as="font" href="/fonts/ROsanswebtextbold.woff" type="font/woff"  crossorigin="anonymous">

    <link href="/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
</head>
<body>
    <!-- use this page (locally) to generate graphics for the statistics page -->
    <!-- to use, disable exclusion in _config.yml at line 162, 
         and restart jekyll in your commandline.
         You can then find this page at 
         http://localhost:4000/generate-statistics-graphic.html .
        You only need to update the two arrays starting around line 65 of this document. 
        Then, copy the SVG codes to (respectively)
        - coronacheck-stats.svg
        - coronacheck-stats-en.svg
        - coronacheck-scanner-stats.svg
        - coronacheck-scanner-stats-en.svg
        And update the download number, tables and date in 
        - layouts/statistics.html
        - layouts/statistics-en.html
    -->

    <section class="container content-block">
        <h1>Generated SVG's</h1>
        <h2>Active users </h2>
        <div class="column-2">
            <div id="CM_1"></div>
            <div>
                <textarea id="CM_1_svg_code"></textarea>
            </div>
        </div>
        <h2>People who sent notifications</h2>
        <div class="column-2">
            <div id="CM_2"></div>
            <div>
                <textarea id="CM_2_svg_code"></textarea>
            </div>
        </div>
        <h2>Positive results after notification</h2>
        <div class="column-2">
            <div id="CM_3"></div>
            <div>
                <textarea id="CM_3_svg_code"></textarea>
            </div>
        </div>
        <h2>Approached through BCO</h2>
        <div class="column-2">
            <div id="CM_4"></div>
            <div>
                <textarea id="CM_4_svg_code"></textarea>
            </div>
        </div>

        <hr />

        <h1>English</h1>
        <h2>Active users </h2>
        <div class="column-2">
            <div id="CM_1_en"></div>
            <div>
                <textarea id="CM_1_svg_code_en"></textarea>
            </div>
        </div>
        <h2>People who sent notifications</h2>
        <div class="column-2">
            <div id="CM_2_en"></div>
            <div>
                <textarea id="CM_2_svg_code_en"></textarea>
            </div>
        </div>
        <h2>Positive results after notification</h2>
        <div class="column-2">
            <div id="CM_3_en"></div>
            <div>
                <textarea id="CM_3_svg_code_en"></textarea>
            </div>
        </div>
        <h2>Approached through BCO</h2>
        <div class="column-2">
            <div id="CM_4_en"></div>
            <div>
                <textarea id="CM_4_svg_code_en"></textarea>
            </div>
        </div>
    </section>

    <!-- for generating the graphs, we use https://observablehq.com/@observablehq -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.4"></script>
    <script type="text/javascript" src="js/statistics/1_active-users.js"></script>
    <script type="text/javascript" src="js/statistics/2_warning-notifications.js"></script>
    <script type="text/javascript" src="js/statistics/3_positive-results-after-notification.js"></script>
    <script type="text/javascript" src="js/statistics/4_approached-through-bco.js"></script>

    <!-- 
        Stacked bar chart:
        
        https://observablehq.com/@d3/stacked-bar-chart

        Plot.plot({
            width,
            y: {tickFormat: "s"},
            color: {scheme: "spectral", domain: ages},
            marks: [
                Plot.barY(stateages, {
                x: "state",
                y: "population",
                fill: "age",
                sort: {x: "y", reverse: true}
                }),
                Plot.ruleY([0])
            ]
        })
     -->

    <script>
        // Dutch statistics
        CM_1 = document.getElementById('CM_1');
        CM_1_svg_code = document.getElementById('CM_1_svg_code');
        CM_2 = document.getElementById('CM_2');
        CM_2_svg_code = document.getElementById('CM_2_svg_code');
        CM_3 = document.getElementById('CM_3');
        CM_3_svg_code = document.getElementById('CM_3_svg_code');
        CM_4 = document.getElementById('CM_4');
        CM_4_svg_code = document.getElementById('CM_4_svg_code');

        // English statistics
        CM_1_en = document.getElementById('CM_1_en');
        CM_1_svg_code_en = document.getElementById('CM_1_svg_code_en');
        CM_2_en = document.getElementById('CM_2_en');
        CM_2_svg_code_en = document.getElementById('CM_2_svg_code_en');
        CM_3_en = document.getElementById('CM_3_en');
        CM_3_svg_code_en = document.getElementById('CM_3_svg_code_en');
        CM_4_en = document.getElementById('CM_4_en');
        CM_4_svg_code_en = document.getElementById('CM_4_svg_code_en');


CM_1.appendChild(
    Plot.plot({
        y: {
            label: "↑ Aantal downloads CoronaMelder (miljoen)",  
            grid: true,
            ticks: [0, 2, 4, 6, 8, 10, 12, 14, 16],
            tickSize: 0,  
            tickFormat: (f => `${f}m`),
            labelOffset: -10,
        },
        x: { 
            label: "Weeknummer →",
            labelAnchor: 'right',  
            labelOffset: -10,   
            ticks: d3.utcMonth.every(2),
            domain: [new Date("2021-03-28"), new Date()],
            tickFormat: (f => f.toLocaleString("nl", { "month": "short",  "year": "numeric" }))
        },
        marks: [
            Plot.line(active_users, {
                x: "date", 
                y: "downloadnr",
                curve: "monotone-y",
                stroke: "#ec025f",
                strokeWidth: 3
            }),
        ],
        tooltip: {
            fill: "red",
            stroke: "blue",
            r: 8
        },
        style: {
            width: 320,
            height: 230,
            fontSize: 14
        },
    })
);

CM_1_en.appendChild(
    Plot.plot({
        y: {
            label: "↑ Number of downloads CoronaMelder (million)",  
            grid: true,
            ticks: [0, 2, 4, 6, 8, 10, 12, 14, 16],
            tickSize: 0,  
            tickFormat: (f => `${f}m`),
            labelOffset: -10,
        },
        x: { 
            label: "Week number →",
            labelAnchor: 'right',  
            labelOffset: -10,   
            ticks: d3.utcMonth.every(2),
            domain: [new Date("2021-03-28"), new Date()],
            tickFormat: (f => f.toLocaleString("en", { "month": "short",  "year": "numeric" }))
            
        },
        marks: [
            Plot.line(active_users, {
                x: "date", 
                y: "downloadnr",
                curve: "monotone-y",
                stroke: "#ec025f",
                strokeWidth: 3
            }),
        ],
        style: {
            width: 320,
            height: 230,
            fontSize: 14
        },
    })
); 


CM_2.appendChild(
    Plot.plot({
        y: {
            label: "↑ Aantal waarschuwingen CoronaMelder",  
            grid: true,
            // ticks: [0, 2, 4, 6, 8, 10, 12, 14, 16],
            // tickSize: 0,  
            tickFormat: (f => `${f}m`),
            labelOffset: -10,
        },
        x: { 
            label: "Maand →",
            labelAnchor: 'right',  
            labelOffset: -10,   
            ticks: d3.utcMonth,
            tickFormat: (f => f.toLocaleString("nl", { "month": "short",  "year": "numeric" }))
        },
        marks: [
            Plot.barY(warning_notifications, {
                x: "date", 
                y: "downloadnr",
                curve: "monotone-y",
                stroke: "#ec025f",
                strokeWidth: 3,
                fill: "test",
            }),
            Plot.ruleY([0])
        ],
        tooltip: {
            fill: "red",
            stroke: "blue",
            r: 8
        },
        style: {
            width: 320,
            height: 230,
            fontSize: 14
        },
    })
);

CM_2_en.appendChild(
    Plot.plot({
        y: {
            label: "↑ Number of warnings CoronaMelder",  
            grid: true,
            // ticks: [0, 2, 4, 6, 8, 10, 12, 14, 16],
            // tickSize: 0,  
            tickFormat: (f => `${f}K`),
            labelOffset: -10,
        },
        x: { 
            label: "Month →",
            labelAnchor: 'right',  
            labelOffset: -10,   
            ticks: d3.utcMonth,
            tickFormat: (f => f.toLocaleString("en", { "month": "short",  "year": "numeric" }))
        },
        marks: [
            Plot.barY(warning_notifications, {
                x: "date", 
                y: "downloadnr",
                curve: "monotone-y",
                stroke: "#ec025f",
                strokeWidth: 3,
                fill: "test",
            }),
            Plot.ruleY([0])
        ],
        style: {
            width: 320,
            height: 230,
            fontSize: 14
        },
    })
); 


    CM_3.appendChild(
    Plot.plot({
        marginBottom: 80,
        x: {
            label: "Maand →",
            tickRotate: -45,
            tickFormat: (f => f.toLocaleString("nl", { "month": "short", "year": "numeric" })),
            stroke: "white",
            ticks: d3.utcMonth.every(1),
        },
        y: {
            label: "↑ Waarschuwingen (x duizend)",
            transform: d => d / 1000,
            grid: true,
            tickFormat: (f => `${f}k`),
        },
        marks: [
        Plot.rectY(positive_results_after_notification, {
            x: "date",
            interval: d3.utcMonth,
            y: "ggd_cumulative",
            fill: "#ec025f",
        }),
        Plot.ruleY([0])
        ], 
    })
    ); 


    CM_3_en.appendChild(
        Plot.plot({
            marginBottom: 80,
            x: {
                label: "Month →",
                tickRotate: -45,
                tickFormat: (f => f.toLocaleString("nl", { "month": "short", "year": "numeric" })),
                stroke: "white",
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Warnings (x thousand)",
                transform: d => d / 1000,
                grid: true,
                tickFormat: (f => `${f}k`),
            },
            marks: [
            Plot.rectY(positive_results_after_notification, {
                x: "date",
                interval: d3.utcMonth,
                y: "ggd_cumulative",
                fill: "#ec025f",
            }),
            Plot.ruleY([0])
            ], 
        })
    ); 


    CM_4.appendChild(
        yesPlot = Plot.plot({
            marginBottom: 80,
            color: {
                legend: true
            },
            x: {
                label: "Maand →",
                tickRotate: -45,
                tickFormat: (f => f.toLocaleString("nl", { "month": "short", "year": "numeric" })),
                stroke: "white",
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Benaderd voor BCO (duizend)",
                transform: d => d / 1000,
                grid: true,
                tickFormat: (f => `${f}k`),
            },
            marks: [
                Plot.rectY(approached_through_bco, {
                    x: "date", 
                    y: "approached",
                    fill: "approached",
                    interval: d3.utcMonth,
                    title:  (d => (d.approached / 1000).toFixed(3)), 
                }),
                Plot.rectY(approached_through_bco, {
                    x: "date", 
                    y: "tested_positive",
                    interval: d3.utcMonth,
                    fill: "#cc0000",
                    title:  (d => (d.tested_positive / 1000).toFixed(3)), 
                }),
                Plot.ruleY([0]),
            ], 
        })
    ); 


    CM_4_en.appendChild(
        Plot.plot({
            marginBottom: 80,
            x: {
                label: "Month →",
                tickRotate: -45,
                tickFormat: (f => f.toLocaleString("nl", { "month": "short", "year": "numeric" })),
                stroke: "white",
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Approached through BCO (x thousand)",
                transform: d => d / 1000,
                grid: true,
                tickFormat: (f => `${f}k`),
            },
            marks: [
                Plot.rectY(approached_through_bco, {
                    x: "date", 
                    y: "approached",
                    fill: "#ec025f",
                    interval: d3.utcMonth,
                    title:  (d => (d.approached / 1000).toFixed(3)),
                }),
                Plot.rectY(approached_through_bco, {
                    x: "date", 
                    y: "tested_positive",
                    interval: d3.utcMonth,
                    fill: "#cc0000",
                    title:  (d => (d.tested_positive / 1000).toFixed(3)),
                }),
                Plot.ruleY([0]),
            ], 
        })
    ); 

    CM_1_svg_code.value = CM_1.getElementsByTagName('svg')[0].innerHTML;
    CM_2_svg_code.value = CM_2.getElementsByTagName('svg')[0].innerHTML;
    CM_3_svg_code.value = CM_3.getElementsByTagName('svg')[0].innerHTML;
    CM_4_svg_code.value = CM_4.getElementsByTagName('svg')[0].innerHTML;

    CM_1_svg_code_en.value = CM_1.getElementsByTagName('svg')[0].innerHTML;
    CM_2_svg_code_en.value = CM_2.getElementsByTagName('svg')[0].innerHTML;
    CM_3_svg_code_en.value = CM_3.getElementsByTagName('svg')[0].innerHTML;
    CM_4_svg_code_en.value = CM_4.getElementsByTagName('svg')[0].innerHTML;
</script>
</body>
</html>
